@page
@using EVDealerSales.BusinessObject.DTOs.VehicleDTOs
@using EVDealerSales.Business.Utils
@model EVDealerSales.Presentation.Pages.Vehicle.BrowseVehiclesModel
@{
    ViewData["Title"] = "Browse Vehicles";
}

@section Styles {
    <link rel="stylesheet" href="~/css/vehicle.css" />
}

<div class="vehicle-browse-container">
    <div class="container-fluid">

        <div class="vehicle-header">
            <div class="text-center">
                <h1 class="vehicle-title">
                    <i class="bi bi-lightning-charge-fill"></i>
                    Browse Our Electric Vehicles
                </h1>
                <p class="vehicle-subtitle">
                    Discover our collection of cutting-edge electric vehicles
                </p>
            </div>
        </div>
        <div class="vehicle-controls">
            <form method="get" class="search-filter-form">
                <div class="search-wrapper">
                    <input type="text"
                           class="search-input"
                           name="search"
                           value="@ViewData["Search"]"
                           placeholder="Search by model or trim..." />
                </div>

                <div class="filter-controls">
                    <select name="sortBy" class="filter-select">
                        <option value="">Sort By</option>
                        <option value="ModelName" selected="@(ViewData["SortBy"]?.ToString() == "ModelName")">Model Name</option>
                        <option value="ModelYear" selected="@(ViewData["SortBy"]?.ToString() == "ModelYear")">Model Year</option>
                        <option value="BasePrice" selected="@(ViewData["SortBy"]?.ToString() == "BasePrice")">Base Price</option>
                    </select>

                    <select name="ascending" class="filter-select">
                        <option value="true" selected="@(ViewData["Ascending"]?.ToString() == "true" || string.IsNullOrEmpty(ViewData["Ascending"]?.ToString()))">Ascending</option>
                        <option value="false" selected="@(ViewData["Ascending"]?.ToString() == "false")">Descending</option>
                    </select>

                    <button type="submit" class="btn-search">
                        <i class="bi bi-search"></i>
                        Search
                    </button>
                </div>
            </form>
        </div>

        @if (Model.Vehicles.TotalCount == 0)
        {
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="bi bi-car-front"></i>
                </div>
                <h3 class="empty-title">No vehicles found</h3>
                <p class="empty-description">
                    @if (!string.IsNullOrEmpty(ViewData["Search"]?.ToString()))
                    {
                        <span>Try adjusting your search criteria or filters</span>
                    }
                    else
                    {
                        <span>Check back soon for new electric vehicles</span>
                    }
                </p>
            </div>
        }
        else
        {
            <div class="vehicle-grid">
                @foreach (var vehicle in Model.Vehicles)
                {
                    <div class="vehicle-card">
                        <a asp-page="/Vehicle/DetailVehicles" asp-route-id="@vehicle.Id" class="vehicle-image-link">
                            <div class="vehicle-image-wrapper">
                                <img src="@(string.IsNullOrEmpty(vehicle.ImageUrl) ? "/placeholder.svg?height=300&width=500" : vehicle.ImageUrl)"
                                     alt="@vehicle.ModelName @vehicle.TrimName"
                                     class="vehicle-image" />
                                <div class="image-overlay">
                                    <i class="bi bi-eye"></i>
                                    <span>View Details</span>
                                </div>
                            </div>
                        </a>

                        <div class="vehicle-card-content">
                            <div class="vehicle-header-info">
                                <h3 class="vehicle-model">@vehicle.ModelName</h3>
                                <p class="vehicle-trim">@vehicle.TrimName</p>
                            </div>

                            <div class="vehicle-meta">
                                <span class="vehicle-year">
                                    <i class="bi bi-calendar3"></i>
                                    @vehicle.ModelYear
                                </span>
                                <span class="vehicle-price">$@vehicle.BasePrice.ToString("N0")</span>
                            </div>

                            <div class="vehicle-specs">
                                <div class="spec-item">
                                    <i class="bi bi-battery-charging"></i>
                                    <div class="spec-content">
                                        <span class="spec-value">@vehicle.BatteryCapacity kWh</span>
                                        <span class="spec-label">Battery</span>
                                    </div>
                                </div>
                                <div class="spec-item">
                                    <i class="bi bi-speedometer"></i>
                                    <div class="spec-content">
                                        <span class="spec-value">@vehicle.RangeKM km</span>
                                        <span class="spec-label">Range</span>
                                    </div>
                                </div>
                                <div class="spec-item">
                                    <i class="bi bi-lightning-charge"></i>
                                    <div class="spec-content">
                                        <span class="spec-value">@vehicle.ChargingTime min</span>
                                        <span class="spec-label">Charging</span>
                                    </div>
                                </div>
                                <div class="spec-item">
                                    <i class="bi bi-speedometer2"></i>
                                    <div class="spec-content">
                                        <span class="spec-value">@vehicle.TopSpeed km/h</span>
                                        <span class="spec-label">Top Speed</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="vehicle-actions">
                            <a asp-page="/Vehicle/DetailVehicles" asp-route-id="@vehicle.Id" class="btn-view-details">
                                View Details
                                <i class="bi bi-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                }
            </div>

            @if (Model.Vehicles.TotalPages > 1)
            {
                <div class="pagination-container">
                    <div class="pagination-info">
                        Showing @((Model.Vehicles.CurrentPage - 1) * Model.Vehicles.PageSize + 1) - @Math.Min(Model.Vehicles.CurrentPage * Model.Vehicles.PageSize, Model.Vehicles.TotalCount) of @Model.Vehicles.TotalCount vehicles
                    </div>
                    <div class="pagination-controls">
                        @if (Model.Vehicles.HasPrevious)
                        {
                            <a class="page-btn"
                               asp-page="./BrowseVehicles"
                               asp-route-PageNumber="@(Model.Vehicles.CurrentPage - 1)"
                               asp-route-PageSize="@Model.Vehicles.PageSize"
                               asp-route-search="@ViewData["Search"]"
                               asp-route-sortBy="@ViewData["SortBy"]"
                               asp-route-ascending="@ViewData["Ascending"]">
                                <i class="bi bi-chevron-left"></i>
                                Previous
                            </a>
                        }

                        @if (Model.Vehicles.HasNext)
                        {
                            <a class="page-btn"
                               asp-page="./BrowseVehicles"
                               asp-route-PageNumber="@(Model.Vehicles.CurrentPage + 1)"
                               asp-route-PageSize="@Model.Vehicles.PageSize"
                               asp-route-search="@ViewData["Search"]"
                               asp-route-sortBy="@ViewData["SortBy"]"
                               asp-route-ascending="@ViewData["Ascending"]">
                                Next
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        }
                    </div>
                </div>
            }
        }
    </div>
</div>